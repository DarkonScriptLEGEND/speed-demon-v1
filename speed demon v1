-- Speed Demon V1 (Updated July 2025)
if getgenv().SpeedDemonLoaded then return end
getgenv().SpeedDemonLoaded = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local Root = Character:WaitForChild("HumanoidRootPart")

local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "SpeedDemonUI"
ScreenGui.ResetOnSpawn = false

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 140, 0, 30)
toggleButton.Position = UDim2.new(0.5, -70, 0.5, -15)
toggleButton.Text = "Speed Demon V1"
toggleButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.BorderSizePixel = 0
toggleButton.Draggable = true
toggleButton.Active = true
toggleButton.Parent = ScreenGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 160)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, 40)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Visible = false
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 6)
UIListLayout.Parent = MainFrame

local function createButton(text, callback)
	local button = Instance.new("TextButton")
	button.Size = UDim2.new(1, -20, 0, 30)
	button.Position = UDim2.new(0, 10, 0, 0)
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Text = text
	button.Font = Enum.Font.Gotham
	button.TextSize = 14
	button.BorderSizePixel = 0
	button.Parent = MainFrame
	button.MouseButton1Click:Connect(callback)
	local corner = Instance.new("UICorner", button)
	corner.CornerRadius = UDim.new(0, 6)
	return button
end

-- Toggle GUI
toggleButton.MouseButton1Click:Connect(function()
	MainFrame.Visible = not MainFrame.Visible
end)

-- Variables
local runAwayActive = false
local lastTeleportTime = 0
local teleportCooldown = 0.95
local safeDistance = 75
local originalSpeed = Humanoid.WalkSpeed
local isTeleporting = false

-- Toggle Run Away
createButton("Toggle Run Away", function()
	runAwayActive = not runAwayActive
end)

-- Teleport Logic
local function isDamage(obj)
	if not obj:IsA("BasePart") then return false end
	local scripts = obj:GetDescendants()
	for _, s in pairs(scripts) do
		if s:IsA("Script") or s:IsA("LocalScript") then
			return true
		end
	end
	return false
end

local function getFurthestSafePosition()
	local regionSize = 100
	local bestPos = nil
	local maxDist = 0
	for x = -regionSize, regionSize, 10 do
		for z = -regionSize, regionSize, 10 do
			local pos = Root.Position + Vector3.new(x, 0, z)
			local ray = Ray.new(pos + Vector3.new(0, 10, 0), Vector3.new(0, -100, 0))
			local hit, point = workspace:FindPartOnRay(ray, Character)
			if hit and hit:IsA("BasePart") and (Root.Position - pos).Magnitude > maxDist then
				bestPos = point + Vector3.new(0, 3, 0)
				maxDist = (Root.Position - pos).Magnitude
			end
		end
	end
	return bestPos
end

local function teleportTo(pos)
	if not pos then return end
	if isTeleporting then return end
	isTeleporting = true
	local currentTime = tick()
	if currentTime - lastTeleportTime < teleportCooldown then return end
	lastTeleportTime = currentTime
	Root.CFrame = CFrame.new(pos)
	Humanoid.WalkSpeed = 45
	task.delay(1.5, function()
		Humanoid.WalkSpeed = originalSpeed
	end)
	task.delay(0.1, function()
		isTeleporting = false
	end)
end

-- Auto Run Loop
RunService.Heartbeat:Connect(function()
	if not runAwayActive then return end
	if not Character or not Root or not Humanoid then return end

	-- Run away from nearby players
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local dist = (player.Character.HumanoidRootPart.Position - Root.Position).Magnitude
			if dist < 35 then
				local awayVec = (Root.Position - player.Character.HumanoidRootPart.Position).Unit * safeDistance
				local newPos = Root.Position + awayVec
				teleportTo(newPos)
			end
		end
	end

	-- Teleport from damage objects
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("BasePart") and (Root.Position - obj.Position).Magnitude < 45 then
			if isDamage(obj) then
				local safePos = getFurthestSafePosition()
				teleportTo(safePos)
				break
			end
		end
	end
end)
